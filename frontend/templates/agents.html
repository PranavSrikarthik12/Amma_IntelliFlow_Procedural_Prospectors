<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Amma ¬∑ Agent Workflow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}

    :root{
      --c-bg:#03050a;
      --c-glow:#00f5d4;
      --c-accent:#ff6b35;
      --c-purple:#7c3aed;
      --c-blue:#0ea5e9;
      --c-white:#f0f4ff;
      --c-muted:#475569;
      --c-surface:rgba(255,255,255,0.03);
      --c-border:rgba(0,245,212,0.1);
      --c-border-bright:rgba(0,245,212,0.25);
      --c-emerald:#10b981;
      --c-ruby:#f43f5e;
      --c-amber:#f59e0b;
      --c-cyan:#06b6d4;
      --sidebar-w:260px;
      --header-h:68px;
    }

    html{scroll-behavior:smooth;overflow-x:hidden;}

    body{
      background:var(--c-bg);
      color:var(--c-white);
      font-family:'DM Sans',sans-serif;
      overflow-x:hidden;
      cursor:none;
      display:flex;
      min-height:100vh;
    }

    /* ‚îÄ‚îÄ‚îÄ CUSTOM CURSOR ‚îÄ‚îÄ‚îÄ */
    .cursor{position:fixed;width:12px;height:12px;background:var(--c-glow);border-radius:50%;pointer-events:none;z-index:9999;transition:transform .1s;mix-blend-mode:screen;top:0;left:0;}
    .cursor-ring{position:fixed;width:40px;height:40px;border:1px solid rgba(0,245,212,.4);border-radius:50%;pointer-events:none;z-index:9998;top:0;left:0;}

    /* ‚îÄ‚îÄ‚îÄ NOISE OVERLAY ‚îÄ‚îÄ‚îÄ */
    body::before{
      content:'';position:fixed;inset:0;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.04'/%3E%3C/svg%3E");
      pointer-events:none;z-index:9000;opacity:.6;
    }

    /* ‚îÄ‚îÄ‚îÄ SCAN LINE ‚îÄ‚îÄ‚îÄ */
    .scan-line{position:fixed;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--c-glow),transparent);opacity:.1;animation:scanDown 7s linear infinite;pointer-events:none;z-index:9001;}
    @keyframes scanDown{from{top:-2px;}to{top:100%;}}

    /* ‚îÄ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ‚îÄ */
    #bg-canvas{position:fixed;inset:0;z-index:0;}

    /* ‚îÄ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ‚îÄ */
    .particles{position:fixed;inset:0;pointer-events:none;z-index:1;}
    .particle{position:absolute;width:2px;height:2px;border-radius:50%;opacity:0;animation:particleFloat linear infinite;}
    @keyframes particleFloat{0%{opacity:0;transform:translateY(100vh) scale(0);}10%{opacity:.7;transform:translateY(90vh) scale(1);}90%{opacity:.7;}100%{opacity:0;transform:translateY(-20px);}}

    /* ‚îÄ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ‚îÄ */
    #loader{position:fixed;inset:0;background:var(--c-bg);z-index:8000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;transition:opacity .8s ease,visibility .8s;}
    #loader.hide{opacity:0;visibility:hidden;pointer-events:none;}
    .loader-text{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,6vw,5rem);letter-spacing:.3em;background:linear-gradient(90deg,var(--c-glow),var(--c-blue),var(--c-purple),var(--c-glow));background-size:300%;-webkit-background-clip:text;color:transparent;animation:shimmer 1.5s linear infinite;}
    .loader-bar{width:240px;height:2px;background:rgba(255,255,255,.08);border-radius:2px;overflow:hidden;}
    .loader-fill{height:100%;background:linear-gradient(90deg,var(--c-glow),var(--c-blue));width:0%;animation:loadFill 1.8s ease forwards;border-radius:2px;}
    .loader-status{font-family:'Space Mono',monospace;font-size:.65rem;letter-spacing:.3em;color:#334155;}
    @keyframes loadFill{to{width:100%;}}
    @keyframes shimmer{0%{background-position:0%;}100%{background-position:200%;}}

    /* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
    ::-webkit-scrollbar{width:4px;height:4px;}
    ::-webkit-scrollbar-track{background:transparent;}
    ::-webkit-scrollbar-thumb{background:rgba(0,245,212,.2);border-radius:4px;}

    /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
    .sidebar{
      width:var(--sidebar-w);min-height:100vh;
      background:rgba(3,5,10,0.95);
      border-right:1px solid var(--c-border);
      position:fixed;top:0;left:0;
      display:flex;flex-direction:column;
      z-index:100;
    }
    .sidebar::after{content:'';position:absolute;top:0;right:0;width:1px;height:100%;background:linear-gradient(180deg,transparent,var(--c-glow) 40%,var(--c-purple) 70%,transparent);opacity:.2;}

    .sidebar-logo{padding:26px 24px 20px;display:flex;align-items:center;gap:14px;border-bottom:1px solid var(--c-border);}
    .logo-mark{width:44px;height:44px;flex-shrink:0;}
    .logo-mark svg{width:44px;height:44px;}
    .logo-ring{animation:logoSpin 8s linear infinite;transform-origin:center;}
    @keyframes logoSpin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
    .logo-text-wrap{display:flex;flex-direction:column;}
    .logo-name{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:.15em;background:linear-gradient(135deg,var(--c-glow),var(--c-blue));-webkit-background-clip:text;color:transparent;line-height:1.2;}
    .logo-tagline{font-family:'Space Mono',monospace;font-size:.55rem;letter-spacing:.18em;color:var(--c-muted);text-transform:uppercase;margin-top:3px;}

    .sidebar-nav{flex:1;padding:16px 0;overflow-y:auto;}
    .nav-section{padding:16px 24px 6px;font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;letter-spacing:.22em;text-transform:uppercase;color:var(--c-muted);display:flex;align-items:center;gap:8px;}
    .nav-section::after{content:'';flex:1;height:1px;background:var(--c-border);}
    .nav-item{display:flex;align-items:center;gap:12px;padding:11px 24px;cursor:pointer;transition:all .25s;text-decoration:none;color:var(--c-muted);font-size:.85rem;font-weight:500;position:relative;border-left:2px solid transparent;margin:1px 0;}
    .nav-item .nav-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;transition:all .25s;flex-shrink:0;}
    .nav-item:hover{color:var(--c-white);background:linear-gradient(90deg,rgba(0,245,212,.04) 0%,transparent 100%);border-left-color:var(--c-glow);}
    .nav-item:hover .nav-icon{background:rgba(0,245,212,.07);}
    .nav-item.active{color:var(--c-white);background:linear-gradient(90deg,rgba(0,245,212,.07) 0%,transparent 100%);border-left-color:var(--c-glow);}
    .nav-item.active .nav-label{color:var(--c-glow);}
    .nav-item.active .nav-icon{background:rgba(0,245,212,.1);}
    .nav-badge{margin-left:auto;font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;padding:2px 8px;border-radius:20px;background:rgba(124,58,237,.15);border:1px solid rgba(124,58,237,.3);color:#a78bfa;}
    .nav-badge.live{background:rgba(0,245,212,.1);border-color:var(--c-border-bright);color:var(--c-glow);}

    .sidebar-footer{padding:16px 24px;border-top:1px solid var(--c-border);}
    .user-pill{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all .25s;background:var(--c-surface);border:1px solid var(--c-border);}
    .user-pill:hover{border-color:var(--c-border-bright);background:rgba(0,245,212,.04);}
    .user-avatar{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--c-purple),#1c1535);display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:15px;color:var(--c-glow);border:1px solid rgba(0,245,212,.2);flex-shrink:0;}
    .user-name{font-size:.8rem;font-weight:600;color:var(--c-white);}
    .user-role{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--c-muted);margin-top:1px;}
    .user-dot{margin-left:auto;width:7px;height:7px;background:var(--c-emerald);border-radius:50%;animation:pulse-dot 2s infinite;}
    @keyframes pulse-dot{0%,100%{opacity:1;}50%{opacity:.4;}}

    /* ‚îÄ‚îÄ‚îÄ MAIN WRAP ‚îÄ‚îÄ‚îÄ */
    .main-wrap{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;min-height:100vh;position:relative;z-index:1;}

    /* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
    .topbar{height:var(--header-h);background:rgba(3,5,10,.9);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-bottom:1px solid var(--c-border);position:sticky;top:0;z-index:50;display:flex;align-items:center;padding:0 32px;gap:20px;}
    .topbar-breadcrumb{display:flex;flex-direction:column;}
    .topbar-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:.15em;color:var(--c-white);}
    .topbar-crumb{font-family:'Space Mono',monospace;font-size:.6rem;letter-spacing:.12em;color:var(--c-muted);}
    .topbar-right{margin-left:auto;display:flex;align-items:center;gap:12px;}
    .topbar-clock{font-family:'Space Mono',monospace;font-size:.72rem;color:var(--c-glow);background:rgba(0,245,212,.07);border:1px solid rgba(0,245,212,.2);padding:7px 14px;border-radius:20px;letter-spacing:.05em;}

    .live-pill{display:flex;align-items:center;gap:6px;font-family:'Space Mono',monospace;font-size:.65rem;font-weight:700;color:var(--c-emerald);background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);padding:5px 12px;border-radius:20px;letter-spacing:.08em;}
    .live-dot{width:6px;height:6px;background:var(--c-emerald);border-radius:50%;animation:pulse-dot 2s infinite;}

    .btn-back{display:flex;align-items:center;gap:8px;padding:9px 20px;background:var(--c-surface);color:var(--c-muted);border:1px solid var(--c-border);border-radius:30px;font-family:'Space Mono',monospace;font-size:.7rem;font-weight:700;cursor:pointer;transition:all .25s;text-decoration:none;letter-spacing:.06em;text-transform:uppercase;}
    .btn-back:hover{border-color:var(--c-glow);color:var(--c-glow);background:rgba(0,245,212,.07);}

    .btn-clear{display:flex;align-items:center;gap:8px;padding:9px 20px;background:rgba(244,63,94,.07);color:var(--c-ruby);border:1px solid rgba(244,63,94,.25);border-radius:30px;font-family:'Space Mono',monospace;font-size:.7rem;font-weight:700;cursor:pointer;transition:all .3s;letter-spacing:.06em;text-transform:uppercase;}
    .btn-clear:hover:not(:disabled){background:var(--c-ruby);color:white;border-color:var(--c-ruby);transform:translateY(-1px);box-shadow:0 6px 20px rgba(244,63,94,.3);}
    .btn-clear:disabled{opacity:.3;cursor:not-allowed;transform:none;}

    /* ‚îÄ‚îÄ‚îÄ PAGE BODY ‚îÄ‚îÄ‚îÄ */
    .page-body{padding:28px 32px;flex:1;}

    /* ‚îÄ‚îÄ‚îÄ HERO STRIP ‚îÄ‚îÄ‚îÄ */
    .hero-strip{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:28px;opacity:0;animation:riseUp .7s ease .1s forwards;}
    .hero-greeting{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,3.5vw,2.8rem);letter-spacing:.08em;line-height:1.1;margin-bottom:6px;}
    .hero-greeting span{background:linear-gradient(135deg,var(--c-glow),var(--c-blue));-webkit-background-clip:text;color:transparent;}
    .hero-sub{font-size:.82rem;color:var(--c-muted);}
    .hero-meta{display:flex;flex-direction:column;align-items:flex-end;gap:8px;}
    .hero-date{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--c-muted);background:var(--c-surface);border:1px solid var(--c-border);padding:7px 14px;border-radius:20px;}

    /* ‚îÄ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ‚îÄ */
    .section-label{display:flex;align-items:center;gap:12px;margin-bottom:14px;font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;letter-spacing:.22em;text-transform:uppercase;color:var(--c-accent);opacity:0;animation:riseUp .6s ease .2s forwards;}
    .section-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--c-accent),transparent);}

    /* ‚îÄ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ‚îÄ */
    .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px;}

    .stat-card{
      background:var(--c-surface);
      border:1px solid var(--c-border);
      border-radius:12px;padding:20px;
      position:relative;overflow:hidden;cursor:pointer;
      opacity:0;transform:translateY(30px);
      transition:all .35s cubic-bezier(.16,1,.3,1);
      display:flex;align-items:center;gap:16px;
    }
    .stat-card.visible{opacity:1;transform:translateY(0);}
    .stat-card::before{content:'';position:absolute;top:0;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent,var(--c-glow),transparent);opacity:0;transition:opacity .3s;}
    .stat-card:hover::before{opacity:.6;}
    .stat-card:hover{border-color:var(--c-border-bright);background:rgba(0,245,212,.03);transform:translateY(-4px);}

    .stat-icon{width:44px;height:44px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
    .si-glow{background:rgba(0,245,212,.1);border:1px solid var(--c-border-bright);}
    .si-emerald{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.15);}
    .si-blue{background:rgba(14,165,233,.1);border:1px solid rgba(14,165,233,.15);}

    .stat-value{font-family:'Space Mono',monospace;font-size:1.9rem;font-weight:700;line-height:1;letter-spacing:-.02em;color:var(--c-white);margin-bottom:4px;}
    .stat-label{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--c-muted);letter-spacing:.06em;text-transform:uppercase;}

    /* ‚îÄ‚îÄ‚îÄ CONNECTION STATUS ‚îÄ‚îÄ‚îÄ */
    .status-glass{
      background:var(--c-surface);
      border:1px solid var(--c-border);
      border-radius:12px;
      padding:14px 22px;
      margin-bottom:22px;
      display:flex;align-items:center;gap:14px;
      opacity:0;animation:riseUp .6s ease .35s forwards;
      position:relative;overflow:hidden;
    }
    .status-glass::after{content:'';position:absolute;left:0;top:0;height:100%;width:2px;background:linear-gradient(180deg,transparent,var(--c-glow),transparent);animation:scanLine 3s ease-in-out infinite;}
    @keyframes scanLine{0%{left:0;opacity:0;}10%{opacity:1;}90%{opacity:1;}100%{left:100%;opacity:0;}}

    .conn-dot{width:8px;height:8px;border-radius:50%;background:var(--c-emerald);flex-shrink:0;animation:connPulse 2s infinite;}
    .conn-dot.disconnected{background:var(--c-ruby);animation:none;}
    @keyframes connPulse{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,.5);}50%{box-shadow:0 0 0 6px rgba(16,185,129,0);}}
    .conn-label{font-family:'Space Mono',monospace;font-size:.78rem;font-weight:700;color:var(--c-white);letter-spacing:.04em;}
    .conn-info{font-size:.78rem;color:var(--c-muted);}
    .conn-meta{margin-left:auto;display:flex;align-items:center;gap:8px;}
    .refresh-rate-tag{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--c-glow);background:rgba(0,245,212,.08);border:1px solid var(--c-border-bright);padding:3px 10px;border-radius:20px;}

    /* ‚îÄ‚îÄ‚îÄ PIPELINE ‚îÄ‚îÄ‚îÄ */
    .pipeline{display:flex;flex-direction:column;gap:14px;}

    /* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
    .empty-state{
      background:var(--c-surface);
      border:1.5px dashed rgba(0,245,212,.12);
      border-radius:16px;padding:80px 40px;text-align:center;
      position:relative;overflow:hidden;
    }
    .empty-state::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(0,245,212,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,245,212,.03) 1px,transparent 1px);background-size:32px 32px;}
    .empty-icon-wrap{font-size:52px;margin-bottom:16px;animation:floatIcon 3s ease-in-out infinite;position:relative;z-index:1;}
    @keyframes floatIcon{0%,100%{transform:translateY(0) rotate(-5deg);}50%{transform:translateY(-12px) rotate(5deg);}}
    .empty-title{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:.12em;color:var(--c-muted);margin-bottom:8px;position:relative;z-index:1;}
    .empty-sub{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--c-muted);position:relative;z-index:1;letter-spacing:.06em;}

    /* ‚îÄ‚îÄ‚îÄ AGENT CARD ‚îÄ‚îÄ‚îÄ */
    .agent-card{
      background:var(--c-surface);
      border:1px solid var(--c-border);
      border-radius:14px;overflow:hidden;
      transition:all .3s cubic-bezier(.4,0,.2,1);
      animation:cardSlideIn .4s ease forwards;
      opacity:0;position:relative;
    }
    @keyframes cardSlideIn{from{opacity:0;transform:translateY(16px) scale(.98);}to{opacity:1;transform:translateY(0) scale(1);}}

    .agent-card:hover{border-color:var(--c-border-bright);background:rgba(0,245,212,.02);transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,0,0,.4),0 0 0 1px rgba(0,245,212,.08);}

    /* Top gradient line */
    .agent-card-topline{position:absolute;top:0;left:0;right:0;height:2px;pointer-events:none;z-index:2;width:100%;}

    /* Left accent bar */
    .agent-card::before{content:'';position:absolute;top:16px;left:0;width:3px;height:calc(100% - 32px);background:linear-gradient(180deg,var(--c-glow),var(--c-purple));border-radius:0 3px 3px 0;opacity:.4;transition:opacity .3s;}
    .agent-card:hover::before{opacity:1;}

    /* Counterfactual variant */
    .agent-card.cf-card{background:linear-gradient(135deg,rgba(124,58,237,.06) 0%,var(--c-surface) 50%);border-color:rgba(124,58,237,.18);}
    .agent-card.cf-card::before{background:linear-gradient(180deg,#a78bfa,#7c3aed);}
    .agent-card.cf-card:hover{border-color:rgba(124,58,237,.35);box-shadow:0 12px 40px rgba(124,58,237,.12);}

    /* New pop */
    .agent-card.new-pop{animation:cardSlideIn .4s ease forwards,newPop .8s ease .4s;}
    @keyframes newPop{0%{box-shadow:0 0 0 0 rgba(0,245,212,.5);}50%{box-shadow:0 0 0 10px rgba(0,245,212,0);}100%{box-shadow:none;}}

    /* ‚îÄ‚îÄ‚îÄ AGENT CARD INNER ‚îÄ‚îÄ‚îÄ */
    .agent-inner{padding:20px 24px 20px 28px;}

    .agent-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;padding-bottom:16px;border-bottom:1px solid var(--c-border);position:relative;}
    .agent-header::after{content:'';position:absolute;bottom:-1px;left:0;width:0;height:1px;background:linear-gradient(90deg,var(--c-glow),var(--c-purple));transition:width .5s cubic-bezier(.4,0,.2,1);}
    .agent-card:hover .agent-header::after{width:100%;}

    .agent-name-wrap{display:flex;align-items:center;gap:14px;}
    .agent-badge{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;background:var(--c-surface);border:1px solid var(--c-border);position:relative;transition:all .3s;}
    .agent-card:hover .agent-badge{background:rgba(0,245,212,.1);border-color:var(--c-border-bright);transform:rotate(-5deg) scale(1.05);}
    .agent-card.cf-card:hover .agent-badge{background:rgba(124,58,237,.15);border-color:rgba(124,58,237,.35);}
    .agent-badge::after{content:'';position:absolute;width:6px;height:6px;background:var(--c-emerald);border-radius:50%;top:-2px;right:-2px;border:1.5px solid var(--c-bg);animation:pulse-dot 2s infinite;}

    .agent-name-block{display:flex;flex-direction:column;gap:4px;}
    .agent-name{font-family:'Space Mono',monospace;font-size:.88rem;font-weight:700;color:var(--c-white);letter-spacing:.03em;}
    .agent-card.cf-card .agent-name{color:#a78bfa;}
    .agent-type-tag{font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;color:var(--c-muted);letter-spacing:.16em;text-transform:uppercase;}

    .agent-header-right{display:flex;align-items:center;gap:10px;}

    .status-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 11px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:20px;font-family:'Space Mono',monospace;font-size:.6rem;color:var(--c-emerald);font-weight:700;text-transform:uppercase;letter-spacing:.08em;}

    .timestamp{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--c-muted);display:flex;align-items:center;gap:5px;background:rgba(255,255,255,.04);border:1px solid var(--c-border);padding:4px 10px;border-radius:20px;}

    /* ‚îÄ‚îÄ‚îÄ I/O SECTIONS ‚îÄ‚îÄ‚îÄ */
    .agent-sections{display:grid;grid-template-columns:1fr 1fr;gap:14px;}

    .io-label{font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;letter-spacing:.16em;text-transform:uppercase;color:var(--c-muted);margin-bottom:8px;display:flex;align-items:center;gap:7px;}
    .io-label-dot{width:6px;height:6px;border-radius:50%;background:var(--c-glow);animation:blink-dot 2s infinite;}
    .io-label-dot.output{background:var(--c-accent);}
    .agent-card.cf-card .io-label-dot{background:#a78bfa;}
    .agent-card.cf-card .io-label-dot.output{background:var(--c-purple);}
    @keyframes blink-dot{0%,100%{opacity:.3;transform:scale(1);}50%{opacity:1;transform:scale(1.3);}}

    pre{
      background:rgba(0,0,0,.3);
      border:1px solid var(--c-border);
      padding:13px 15px;border-radius:10px;
      overflow-x:auto;font-family:'Space Mono',monospace;
      font-size:.7rem;color:var(--c-muted);
      max-height:180px;line-height:1.7;
      transition:border-color .25s;
    }
    pre:hover{border-color:rgba(0,245,212,.2);}
    pre::-webkit-scrollbar{width:3px;height:3px;}
    pre::-webkit-scrollbar-thumb{background:rgba(0,245,212,.2);border-radius:3px;}

    /* ‚îÄ‚îÄ‚îÄ PIPELINE CONNECTOR ‚îÄ‚îÄ‚îÄ */
    .pipeline-connector{display:flex;justify-content:center;align-items:center;height:14px;position:relative;}
    .pipeline-connector::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:1px;height:14px;background:linear-gradient(180deg,var(--c-border),rgba(0,245,212,.35));}
    .pipeline-connector .flow-dot{width:6px;height:6px;border-radius:50%;background:var(--c-glow);border:1px solid var(--c-border-bright);position:relative;z-index:1;animation:flowPulse 1.5s ease-in-out infinite;}
    @keyframes flowPulse{0%,100%{transform:scale(1);opacity:.5;}50%{transform:scale(1.4);opacity:1;}}

    /* ‚îÄ‚îÄ‚îÄ AGENT TYPE COLORS ‚îÄ‚îÄ‚îÄ */
    .type-intake{color:var(--c-cyan);}
    .type-analysis{color:var(--c-glow);}
    .type-retrieval{color:var(--c-blue);}
    .type-reasoning{color:var(--c-amber);}
    .type-action{color:var(--c-emerald);}
    .type-simulation{color:#a78bfa;}
    .type-guardrail{color:var(--c-ruby);}

    /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
    .toast-stack{position:fixed;top:80px;right:24px;z-index:9998;display:flex;flex-direction:column;gap:10px;}
    .toast-item{background:rgba(3,5,10,.95);border:1px solid var(--c-border);border-left:3px solid var(--c-emerald);border-radius:10px;padding:14px 18px;max-width:300px;display:flex;align-items:flex-start;gap:10px;font-size:.82rem;color:var(--c-white);box-shadow:0 12px 40px rgba(0,0,0,.5);animation:toastIn .4s cubic-bezier(.4,0,.2,1);backdrop-filter:blur(12px);}
    .toast-item.warn{border-left-color:var(--c-ruby);}
    @keyframes toastIn{from{opacity:0;transform:translateX(40px) scale(.95);}to{opacity:1;transform:translateX(0) scale(1);}}

    /* ‚îÄ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ‚îÄ */
    @keyframes riseUp{from{opacity:0;transform:translateY(28px);}to{opacity:1;transform:translateY(0);}}

    /* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
    footer{padding:20px 32px;border-top:1px solid var(--c-border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;position:relative;z-index:10;}
    .footer-logo{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;background:linear-gradient(90deg,var(--c-glow),var(--c-blue));-webkit-background-clip:text;color:transparent;letter-spacing:.15em;}
    .footer-copy{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--c-muted);}

    /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
    @media(max-width:1100px){:root{--sidebar-w:68px;}.logo-text-wrap,.nav-badge,.nav-section,.user-name,.user-role{display:none;}.nav-item{justify-content:center;padding:12px;}.sidebar-footer{padding:10px;}.user-pill{justify-content:center;}.stats-grid{grid-template-columns:1fr;}}
    @media(max-width:900px){.agent-sections{grid-template-columns:1fr;}}
    @media(max-width:768px){:root{--sidebar-w:0px;}.sidebar{transform:translateX(-260px);}.page-body{padding:16px;}.stats-grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>

  <!-- CURSOR -->
  <div class="cursor" id="cursor"></div>
  <div class="cursor-ring" id="cursor-ring"></div>

  <!-- SCAN LINE -->
  <div class="scan-line"></div>

  <!-- LOADER -->
  <div id="loader">
    <div class="loader-text">AGENT MONITOR</div>
    <div style="font-family:'Space Mono',monospace;font-size:.62rem;letter-spacing:.35em;color:#1e293b;margin-bottom:4px;">AMMA ¬∑ PIPELINE TRACE</div>
    <div class="loader-bar"><div class="loader-fill"></div></div>
    <div class="loader-status">CONNECTING TO AGENT PIPELINE...</div>
  </div>

  <canvas id="bg-canvas"></canvas>
  <div class="particles" id="particles"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-mark">
        <svg viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="22" cy="22" r="20" stroke="rgba(0,245,212,0.12)" stroke-width="1.5"/>
          <g class="logo-ring">
            <circle cx="22" cy="22" r="18" stroke="url(#logoGrad)" stroke-width="1" stroke-dasharray="6 4" stroke-linecap="round"/>
          </g>
          <circle cx="22" cy="22" r="12" fill="rgba(0,245,212,0.05)" stroke="rgba(0,245,212,0.2)" stroke-width="1"/>
          <text x="22" y="27" text-anchor="middle" font-family="'Bebas Neue', sans-serif" font-weight="700" font-size="13" fill="url(#logoTextGrad)">A</text>
          <defs>
            <linearGradient id="logoGrad" x1="4" y1="4" x2="40" y2="40"><stop offset="0%" stop-color="#00f5d4"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>
            <linearGradient id="logoTextGrad" x1="0" y1="0" x2="44" y2="44"><stop offset="0%" stop-color="#00f5d4"/><stop offset="100%" stop-color="#0ea5e9"/></linearGradient>
          </defs>
        </svg>
      </div>
      <div class="logo-text-wrap">
        <div class="logo-name">AMMA</div>
        <div class="logo-tagline">Supply Chain Intelligence</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">Core</div>

      <a class="nav-item" href="/dashboard">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        </div>
        <span class="nav-label">Dashboard</span>
      </a>

      <a class="nav-item" href="/" onclick="event.preventDefault(); window.location.href='/';">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <span class="nav-label">Upload Reports</span>
      </a>

      <a class="nav-item active" href="/agents">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
        </div>
        <span class="nav-label">Agent Workflow</span>
        <span class="nav-badge live">LIVE</span>
      </a>

      <div class="nav-section">Analytics</div>

      <a class="nav-item" href="/dashboard#analytics">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        </div>
        <span class="nav-label">Analytics</span>
      </a>

      <a class="nav-item" href="/dashboard#insights">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a7 7 0 015.29 11.53L21 17v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-1l3.71-3.47A7 7 0 0112 2z"/><path d="M9 22v-1M12 22v-1M15 22v-1"/></svg>
        </div>
        <span class="nav-label">AI Insights</span>
      </a>

      <div class="nav-section">System</div>

      <a class="nav-item" href="/alerts">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        </div>
        <span class="nav-label">Alerts</span>
      </a>

      <a class="nav-item" href="/settings">
        <div class="nav-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 010 14.14M4.93 4.93a10 10 0 000 14.14"/></svg>
        </div>
        <span class="nav-label">Settings</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-pill">
        <div class="user-avatar">AM</div>
        <div>
          <div class="user-name">Admin</div>
          <div class="user-role">Senior Analyst</div>
        </div>
        <div class="user-dot"></div>
      </div>
    </div>
  </aside>

  <!-- ‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê -->
  <div class="main-wrap">

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-breadcrumb">
        <div class="topbar-title">AGENT WORKFLOW</div>
        <div class="topbar-crumb">LIVE AUTONOMOUS PIPELINE EXECUTION TRACE</div>
      </div>
      <div class="topbar-right">
        <div class="live-pill"><span class="live-dot"></span>MONITORING</div>
        <div class="topbar-clock" id="liveClock">‚Äî</div>
        <a class="btn-back" href="/dashboard">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
          DASHBOARD
        </a>
        <button class="btn-clear" id="clearBtn" onclick="clearLogs()" disabled>
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/></svg>
          CLEAR LOGS
        </button>
      </div>
    </header>

    <!-- PAGE BODY -->
    <div class="page-body">

      <!-- HERO -->
      <div class="hero-strip">
        <div>
          <div class="hero-greeting">Pipeline <span>Execution Trace</span> üî¨</div>
          <div class="hero-sub">Each agent in the autonomous supply-chain finance pipeline, logged in real time.</div>
        </div>
        <div class="hero-meta">
          <div class="hero-date" id="heroDate">‚Äî</div>
          <div class="live-pill" style="font-size:.65rem;">
            <span class="live-dot"></span>AUTO-REFRESH ¬∑ 2S
          </div>
        </div>
      </div>

      <!-- STAT CARDS -->
      <div class="section-label">Pipeline Metrics</div>
      <div class="stats-grid">

        <div class="stat-card">
          <div class="stat-icon si-glow">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#00f5d4" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          </div>
          <div>
            <div class="stat-value" id="totalExecutions">0</div>
            <div class="stat-label">Total Executions</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon si-emerald">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
          </div>
          <div>
            <div class="stat-value" id="activeAgents">0</div>
            <div class="stat-label">Active Agents</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon si-blue">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
          <div>
            <div class="stat-value" id="lastUpdate" style="font-size:1.1rem;letter-spacing:0;">‚Äî</div>
            <div class="stat-label">Last Updated</div>
          </div>
        </div>

      </div>

      <!-- CONNECTION STATUS -->
      <div class="status-glass">
        <svg style="position:absolute;right:24px;top:50%;transform:translateY(-50%);opacity:0.05;pointer-events:none;" width="180" height="30" viewBox="0 0 180 30">
          <path d="M0 15 H40 L50 5 H70 L80 25 H100 L110 15 H180" stroke="#00f5d4" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="40" cy="15" r="3" fill="#00f5d4"/>
          <circle cx="100" cy="15" r="3" fill="#0ea5e9"/>
        </svg>
        <div class="conn-dot" id="connDot"></div>
        <span class="conn-label" id="connLabel">Connecting‚Ä¶</span>
        <span class="conn-info" id="connectionInfo">Establishing real-time connection to agent pipeline‚Ä¶</span>
        <div class="conn-meta">
          <div class="refresh-rate-tag">‚ö° 2s refresh</div>
        </div>
      </div>

      <!-- PIPELINE -->
      <div class="section-label">Agent Execution Log</div>
      <div id="pipeline" class="pipeline">
        <div class="empty-state">
          <div class="empty-icon-wrap">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="14" y="22" width="36" height="28" rx="6" stroke="#00f5d4" stroke-width="1.5" stroke-dasharray="4 3"/>
              <circle cx="24" cy="34" r="4" stroke="#0ea5e9" stroke-width="1.5"/>
              <circle cx="40" cy="34" r="4" stroke="#0ea5e9" stroke-width="1.5"/>
              <path d="M26 44 H38" stroke="#10b981" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M32 22 V14" stroke="#00f5d4" stroke-width="1.5" stroke-linecap="round"/>
              <circle cx="32" cy="12" r="3" stroke="#00f5d4" stroke-width="1.5"/>
              <path d="M14 36 H8" stroke="#0ea5e9" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M50 36 H56" stroke="#0ea5e9" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="empty-title">Awaiting Agent Activity</div>
          <div class="empty-sub">Upload a report or send a chat query to trigger the pipeline</div>
        </div>
      </div>

    </div>

    <footer>
      <div class="footer-logo">TECHATHON 2.0</div>
      <div class="footer-copy">¬© 2025 Procedural Prospectors ¬∑ Built with ‚ù§Ô∏è and AI</div>
    </footer>
  </div>

  <!-- TOAST CONTAINER -->
  <div class="toast-stack" id="toastStack"></div>

  <script>
    /* ‚îÄ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ‚îÄ */
    window.addEventListener('load', () => {
      setTimeout(() => { document.getElementById('loader').classList.add('hide'); }, 2000);
    });

    /* ‚îÄ‚îÄ‚îÄ CUSTOM CURSOR ‚îÄ‚îÄ‚îÄ */
    const cursor = document.getElementById('cursor');
    const ring = document.getElementById('cursor-ring');
    let mx = 0, my = 0, rx = 0, ry = 0;
    document.addEventListener('mousemove', e => {
      mx = e.clientX; my = e.clientY;
      cursor.style.left = (mx - 6) + 'px'; cursor.style.top = (my - 6) + 'px';
    });
    (function animRing() {
      rx += (mx - rx) * .1; ry += (my - ry) * .1;
      ring.style.left = (rx - 20) + 'px'; ring.style.top = (ry - 20) + 'px';
      requestAnimationFrame(animRing);
    })();
    document.querySelectorAll('a,button,.stat-card,.agent-card,.nav-item,.user-pill').forEach(el => {
      el.addEventListener('mouseenter', () => { cursor.style.transform = 'scale(2.5)'; ring.style.transform = 'scale(1.4)'; });
      el.addEventListener('mouseleave', () => { cursor.style.transform = 'scale(1)'; ring.style.transform = 'scale(1)'; });
    });

    /* ‚îÄ‚îÄ‚îÄ CANVAS BACKGROUND ‚îÄ‚îÄ‚îÄ */
    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let W, H, dots = [];
    function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
    resize(); window.addEventListener('resize', resize);
    for (let i = 0; i < 90; i++) dots.push({
      x: Math.random() * window.innerWidth, y: Math.random() * window.innerHeight,
      vx: (Math.random() - .5) * .2, vy: (Math.random() - .5) * .2,
      r: Math.random() * 1.4 + .3, alpha: Math.random() * .4 + .08
    });
    (function drawCanvas() {
      ctx.clearRect(0, 0, W, H);
      for (let i = 0; i < dots.length; i++) {
        for (let j = i + 1; j < dots.length; j++) {
          const dx = dots[i].x - dots[j].x, dy = dots[i].y - dots[j].y;
          const d = Math.sqrt(dx * dx + dy * dy);
          if (d < 120) { ctx.beginPath(); ctx.strokeStyle = `rgba(0,245,212,${.03 * (1 - d / 120)})`; ctx.lineWidth = .5; ctx.moveTo(dots[i].x, dots[i].y); ctx.lineTo(dots[j].x, dots[j].y); ctx.stroke(); }
        }
        dots[i].x += dots[i].vx; dots[i].y += dots[i].vy;
        if (dots[i].x < 0 || dots[i].x > W) dots[i].vx *= -1;
        if (dots[i].y < 0 || dots[i].y > H) dots[i].vy *= -1;
        ctx.beginPath(); ctx.arc(dots[i].x, dots[i].y, dots[i].r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(0,245,212,${dots[i].alpha})`; ctx.fill();
      }
      requestAnimationFrame(drawCanvas);
    })();

    /* ‚îÄ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ‚îÄ */
    const pc = document.getElementById('particles');
    const pColors = ['#00f5d4', '#7c3aed', '#0ea5e9', '#ff6b35'];
    for (let i = 0; i < 25; i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      const left = Math.random() * 100, dur = Math.random() * 18 + 10, delay = Math.random() * 12, size = Math.random() * 2 + .5;
      p.style.cssText = `left:${left}%;width:${size}px;height:${size}px;background:${pColors[Math.floor(Math.random() * 4)]};animation-duration:${dur}s;animation-delay:-${delay}s;`;
      pc.appendChild(p);
    }

    /* ‚îÄ‚îÄ‚îÄ INTERSECTION OBSERVER ‚îÄ‚îÄ‚îÄ */
    const io = new IntersectionObserver(entries => {
      entries.forEach(e => { if (e.isIntersecting) setTimeout(() => e.target.classList.add('visible'), e.target.dataset.delay || 0); });
    }, { threshold: .1 });
    document.querySelectorAll('.stat-card').forEach((el, i) => { el.dataset.delay = i * 80; io.observe(el); });

    /* ‚îÄ‚îÄ Agent metadata ‚îÄ‚îÄ */
    const AGENT_META = {
      'ReportUnderstandingAgent':         { icon: 'üì•', type: 'Data Intake',           typeClass: 'type-intake' },
      'AnomalyDetectionAgent':            { icon: '‚ö†Ô∏è', type: 'Anomaly Analysis',      typeClass: 'type-analysis' },
      'IntentClassificationAgent':        { icon: 'üéØ', type: 'Intent Classification',  typeClass: 'type-analysis' },
      'RAGEmbeddingAgent':                { icon: 'üíæ', type: 'Vector Embedding',       typeClass: 'type-retrieval' },
      'RAGRetrievalAgent':                { icon: 'üîç', type: 'Context Retrieval',      typeClass: 'type-retrieval' },
      'RootCauseReasoningAgent':          { icon: 'üß†', type: 'Root Cause Reasoning',   typeClass: 'type-reasoning' },
      'ActionRecommendationAgent':        { icon: '‚úÖ', type: 'Action Planner',         typeClass: 'type-action' },
      'CounterfactualSimulationAgent':    { icon: 'üîÆ', type: 'What-If Simulation',     typeClass: 'type-simulation' },
      'DecisionConfidenceGuardrailAgent': { icon: 'üõ°Ô∏è', type: 'Confidence Guardrail',  typeClass: 'type-guardrail' },
    };
    const DEFAULT_META = { icon: 'ü§ñ', type: 'Agent', typeClass: 'type-analysis' };

    /* ‚îÄ‚îÄ Clock ‚îÄ‚îÄ */
    function tickClock() {
      const now = new Date();
      document.getElementById('liveClock').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      document.getElementById('heroDate').textContent = now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
    }
    tickClock(); setInterval(tickClock, 1000);

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    function showToast(msg, type = 'ok') {
      const stack = document.getElementById('toastStack');
      const el = document.createElement('div');
      el.className = `toast-item${type === 'warn' ? ' warn' : ''}`;
      el.innerHTML = `<span>${type === 'ok' ? '‚úÖ' : '‚ö†Ô∏è'}</span><span>${msg}</span>`;
      stack.appendChild(el);
      setTimeout(() => {
        el.style.transition = 'all .4s';
        el.style.opacity = '0';
        el.style.transform = 'translateX(40px)';
        setTimeout(() => el.remove(), 400);
      }, 3500);
    }

    /* ‚îÄ‚îÄ Counter animation ‚îÄ‚îÄ */
    function animateCounter(el, target) {
      if (!el) return;
      const curr = parseInt(el.textContent) || 0;
      if (curr === target) return;
      let step = curr;
      const inc = (target - curr) / 12;
      const timer = setInterval(() => {
        step += inc;
        if ((inc > 0 && step >= target) || (inc < 0 && step <= target)) { step = target; clearInterval(timer); }
        el.textContent = Math.floor(step);
      }, 40);
    }

    /* ‚îÄ‚îÄ Connection status ‚îÄ‚îÄ */
    let isConnected = false;
    let previousLogCount = 0;
    let pollingInterval = null;

    function updateConnectionStatus(connected) {
      isConnected = connected;
      const dot   = document.getElementById('connDot');
      const label = document.getElementById('connLabel');
      const info  = document.getElementById('connectionInfo');
      const btn   = document.getElementById('clearBtn');

      if (connected) {
        dot.classList.remove('disconnected');
        label.textContent = 'üü¢ PIPELINE ACTIVE';
        info.textContent  = 'Monitoring agent execution in real-time ¬∑ supply_chain_finance domain';
        if (previousLogCount > 0) btn.disabled = false;
      } else {
        dot.classList.add('disconnected');
        label.textContent = 'üî¥ CONNECTION LOST';
        info.textContent  = 'Attempting to reconnect to agent-logs endpoint‚Ä¶';
        btn.disabled = true;
      }
    }

    /* ‚îÄ‚îÄ Build agent card HTML ‚îÄ‚îÄ */
    function buildAgentCard(log, isNew) {
      const meta = AGENT_META[log.agent] || DEFAULT_META;
      const isCF = log.agent === 'CounterfactualSimulationAgent';
      const isGuard = log.agent === 'DecisionConfidenceGuardrailAgent';

      const cardClass = `agent-card${isCF ? ' cf-card' : ''}${isNew ? ' new-pop' : ''}`;
      const topColor1 = isCF ? '#a78bfa' : isGuard ? '#f43f5e' : '#00f5d4';
      const topColor2 = isCF ? '#7c3aed' : isGuard ? '#f59e0b' : '#0ea5e9';
      const uid = log.agent.slice(0, 6) + '_' + Date.now();

      const topLine = `<svg class="agent-card-topline" viewBox="0 0 800 2" preserveAspectRatio="none" style="position:absolute;top:0;left:0;right:0;width:100%;height:2px;pointer-events:none;z-index:2;">
        <defs><linearGradient id="tg_${uid}" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="transparent"/>
          <stop offset="25%" stop-color="${topColor1}"/>
          <stop offset="75%" stop-color="${topColor2}"/>
          <stop offset="100%" stop-color="transparent"/>
        </linearGradient></defs>
        <line x1="0" y1="1" x2="800" y2="1" stroke="url(#tg_${uid})" stroke-width="2"/>
      </svg>`;

      return `<div class="${cardClass}">
        ${topLine}
        <div class="agent-inner">
          <div class="agent-header">
            <div class="agent-name-wrap">
              <div class="agent-badge">${meta.icon}</div>
              <div class="agent-name-block">
                <div class="agent-name">${log.agent}</div>
                <div class="agent-type-tag ${meta.typeClass}">${meta.type}</div>
              </div>
            </div>
            <div class="agent-header-right">
              <div class="timestamp">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                ${log.timestamp}
              </div>
              <span class="status-badge">
                <svg width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                Completed
              </span>
            </div>
          </div>
          <div class="agent-sections">
            <div>
              <div class="io-label"><div class="io-label-dot"></div>Input</div>
              <pre>${formatData(log.input)}</pre>
            </div>
            <div>
              <div class="io-label"><div class="io-label-dot output"></div>Output</div>
              <pre>${formatData(log.output)}</pre>
            </div>
          </div>
        </div>
      </div>`;
    }

    /* ‚îÄ‚îÄ Format log data ‚îÄ‚îÄ */
    function formatData(data) {
      if (!data) return '‚Äî';
      if (typeof data === 'string') return data;
      try { return JSON.stringify(data, null, 2); }
      catch { return String(data); }
    }

    /* ‚îÄ‚îÄ Load agent logs ‚îÄ‚îÄ */
    async function loadAgentLogs() {
      try {
        const res = await fetch('/agent-logs');
        if (!res.ok) throw new Error('Failed to fetch logs');

        const logs = await res.json();
        const pipeline = document.getElementById('pipeline');

        if (!isConnected) updateConnectionStatus(true);

        animateCounter(document.getElementById('totalExecutions'), logs.length);
        animateCounter(document.getElementById('activeAgents'), new Set(logs.map(l => l.agent)).size);

        const lastUpdateEl = document.getElementById('lastUpdate');
        if (logs.length > 0) lastUpdateEl.textContent = new Date().toLocaleTimeString();

        if (!logs || logs.length === 0) {
          pipeline.innerHTML = `<div class="empty-state">
            <div class="empty-icon-wrap">
              <svg width="64" height="64" viewBox="0 0 64 64" fill="none"><rect x="14" y="22" width="36" height="28" rx="6" stroke="#00f5d4" stroke-width="1.5" stroke-dasharray="4 3"/><circle cx="24" cy="34" r="4" stroke="#0ea5e9" stroke-width="1.5"/><circle cx="40" cy="34" r="4" stroke="#0ea5e9" stroke-width="1.5"/><path d="M26 44 H38" stroke="#10b981" stroke-width="1.5" stroke-linecap="round"/><path d="M32 22 V14" stroke="#00f5d4" stroke-width="1.5" stroke-linecap="round"/><circle cx="32" cy="12" r="3" stroke="#00f5d4" stroke-width="1.5"/><path d="M14 36 H8" stroke="#0ea5e9" stroke-width="1.5" stroke-linecap="round"/><path d="M50 36 H56" stroke="#0ea5e9" stroke-width="1.5" stroke-linecap="round"/></svg>
            </div>
            <div class="empty-title">Awaiting Agent Activity</div>
            <div class="empty-sub">Upload a report or send a chat query to trigger the pipeline</div>
          </div>`;
          previousLogCount = 0;
          document.getElementById('clearBtn').disabled = true;
          return;
        }

        const hasNew = logs.length > previousLogCount;
        if (logs.length > 0) document.getElementById('clearBtn').disabled = false;

        if (hasNew || previousLogCount === 0) {
          previousLogCount = logs.length;
          pipeline.innerHTML = '';

          const reversed = logs.slice().reverse();

          reversed.forEach((log, index) => {
            const isNew = hasNew && index === 0 && previousLogCount > 1;
            const cardHTML = buildAgentCard(log, isNew);
            const wrapper = document.createElement('div');
            wrapper.innerHTML = cardHTML;
            const card = wrapper.firstElementChild;
            pipeline.appendChild(card);

            if (index < reversed.length - 1) {
              const conn = document.createElement('div');
              conn.className = 'pipeline-connector';
              conn.innerHTML = '<div class="flow-dot"></div>';
              pipeline.appendChild(conn);
            }
          });

          if (hasNew && previousLogCount > 1) showToast('New agent step recorded');
        }

      } catch (err) {
        console.error('Error:', err);
        updateConnectionStatus(false);
        if (previousLogCount === 0) {
          document.getElementById('pipeline').innerHTML = `<div class="empty-state">
            <div class="empty-icon-wrap">‚ö†Ô∏è</div>
            <div class="empty-title">Cannot Reach Pipeline</div>
            <div class="empty-sub">Check your connection and ensure the Flask server is running</div>
          </div>`;
        }
      }
    }

    /* ‚îÄ‚îÄ Clear logs ‚îÄ‚îÄ */
    async function clearLogs() {
      if (!confirm('Clear all agent execution logs? This cannot be undone.')) return;

      const btn = document.getElementById('clearBtn');
      btn.disabled = true;

      try {
        const res = await fetch('/clear-logs', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
        if (!res.ok) throw new Error();

        previousLogCount = 0;
        document.getElementById('totalExecutions').textContent = '0';
        document.getElementById('activeAgents').textContent = '0';
        document.getElementById('pipeline').innerHTML = `<div class="empty-state">
          <div class="empty-icon-wrap">‚úÖ</div>
          <div class="empty-title">Logs Cleared</div>
          <div class="empty-sub">Pipeline monitor is ready for new agent activity</div>
        </div>`;

        showToast('Agent logs cleared successfully');
        setTimeout(loadAgentLogs, 1200);
      } catch {
        showToast('Failed to clear logs', 'warn');
        btn.disabled = false;
      }
    }

    /* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
    loadAgentLogs();
    pollingInterval = setInterval(loadAgentLogs, 2000);
    window.addEventListener('beforeunload', () => { if (pollingInterval) clearInterval(pollingInterval); });
  </script>
</body>
</html>